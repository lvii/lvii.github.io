---
layout: post
title: "MacOS 自然码双拼输入法 —— 鼠鬚管"
category: system
tags: [rime, squirrel, macos]
---

# WHY

公元 9102 年 MacOS 内置中文输入法依然不支持 **最基础** 的双拼码表：**自然码** - -'

# WHAT

[RIME、「中州韻」、「小狼毫」和「鼠鬚管」来历](https://rime.im/blog/2016/04/14/qna-in-mtvu/)

# HOW

沉寂 4 年后 RIME 中文输入法平台 MacOS 下的实现 **鼠鬚管** 更新至 `0.10.0` (2019-01-01)

 决定重新回归小巧的 **鼠鬚管** 输入法

<https://rime.im/release/squirrel/>

> 精簡安裝包預裝的輸入方案，更多方案可由 [東風破](https://github.com/rime/plum) 取得

新版本 `0.10.0` 默认只有 **朙月拼音** 输入法，其他第三方要用 [東風破](https://github.com/rime/plum) 额外安装

下载安装后 **鼠鬚管** 的 **朙月拼音** 输入法是 **繁体中文**

使用 `` Ctrl + ` `` 快捷键即可切换至 **简体中文** ：

![img](https://i.imgur.com/BKlDSQn.png)

## `double_pinyin.schema.yaml`

[https://github.com/rime/home/wiki/UserGuide#雙拼](https://github.com/rime/home/wiki/UserGuide#%E9%9B%99%E6%8B%BC)

> 雙拼與【朙月拼音】、語句流輸入方案 **共用** 一份 **碼表** 和 **用戶詞典**。

RIME 的双拼输入方案：<https://github.com/rime/rime-double-pinyin>

默认即是 **自然码** 输入方案：

<https://github.com/rime/rime-double-pinyin/blob/master/double_pinyin.schema.yaml>

RIME 用户配置目录位于 `~/Library/Rime/` 相关的 YAML 配置文件：

配置文件 | 关于
:------- | :---
`default.custom.yaml` | 配置 **可用** 输入法列表 <sup>[1](https://github.com/rime/home/wiki/RimeWithSchemata#rime-中的數據文件分佈及作用)</sup>
`squirrel.custom.yaml` | 配置 **候选框** 配色方案 <sup>[2](https://github.com/rime/home/wiki/CustomizationGuide#鼠鬚管外觀與鍵盤設定)</sup>
`double_pinyin.schema.yaml` | 配置 **双拼自然码** 码表 <sup>[3](https://github.com/rime/home/wiki/RimeWithSchemata#三最高武藝)</sup>

下载配置：

    $ cd ~/Library/Rime/

    $ yaml_path=https://raw.githubusercontent.com/rime/rime-double-pinyin/master/double_pinyin.schema.yaml

    $ curl -L $yaml_path -o double_pinyin.schema.yaml
      % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                     Dload  Upload   Total   Spent    Left  Speed
    100  3074  100  3074    0     0   1566      0  0:00:01  0:00:01 --:--:--  1567

下载的配置依赖 **筆畫** 输入法，需要注释相关配置，并设置默认为 **简体中文** ：

    $ cp -iv double_pinyin.schema.yaml{,.ori}
    double_pinyin.schema.yaml -> double_pinyin.schema.yaml.ori

    $ diff -y double_pinyin.schema.yaml double_pinyin.schema.yaml.ori

      # dependencies:                         |   dependencies:
      #   - stroke                            |     - stroke

        reset: 1                              <
        states: [ 漢字, 汉字 ]                      states: [ 漢字, 汉字 ]

    # reverse_lookup:                         | reverse_lookup:
    #   dictionary: stroke                    |   dictionary: stroke
    #   enable_completion: true               |   enable_completion: true
    #   prefix: "`"                           |   prefix: "`"
    #   suffix: "'"                           |   suffix: "'"
    #   tips: 〔筆畫〕                        |   tips: 〔筆畫〕
    #   preedit_format:                       |   preedit_format:
    #     - xlit/hspnz/一丨丿丶乙/            |     - xlit/hspnz/一丨丿丶乙/
    #   comment_format:                       |   comment_format:
    #     - xform/([nl])v/$1ü/                |     - xform/([nl])v/$1ü/

[【智能ABC雙拼】輸入方案示例](https://github.com/rime/home/wiki/RimeWithSchemata#三最高武藝)

## `default.custom.yaml`

然后修改 `default.custom.yaml` 配置的可用输入法列表：

    $ cat default.custom.yaml
    patch:
      schema_list:
        - schema: double_pinyin        # 自然码双拼
        - schema: luna_pinyin_simp     # 简体全拼

## `squirrel.custom.yaml`

修改 **候选框** 样式：

    $ cat squirrel.custom.yaml
    patch:
      style:
        color_scheme: google                    # 方案命名，不能有空格
        horizontal: true
        inline_preedit: true                    # 单行显示，false双行显示
        candidate_format: "%c\u2005%@"          # 用 1/6 em 空格 U+2005 来控制编号 %c 和候选词 %@ 前后的空间
        corner_radius: 3                        # 候选条圆角
        hilited_corner_radius: 3                # 高亮圆角
        border_height: 4                        # 窗口边界高度，大于圆角半径才生效
        border_width: 4                         # 窗口边界宽度，大于圆角半径才生效
        border_color_width: 0
        font_face: "PingFangSC"                 # 候选词字体
        font_point: 16                          # 候选字词大小
        label_font_point: 14

## sogou dictionary

默认自带的码表不够丰富，使用搜狗字典扩展码表：

<https://github.com/15cm/rime-sogou-dictionaries>

> `luna_pinyin.sogou.dict.yaml` is used in [my rime config](https://github.com/15cm/rime-config). The maintained dictionary is generated by a regexp filter `(计算机|日本|官方推荐|大全).*\.scel$`.

1. 下载 `luna_pinyin.sogou.dict.yaml` 码表文件
2. 生成导入 sogou 码表的 `double_pinyin.custom.yaml` 配置文件
3. 重新部署 rime 输入法

导入 sogou 码表的配置文件：


    $ cat luna_pinyin.extended.dict.yaml
    ---
    name: luna_pinyin.extended
    version: "2021.03.15"
    sort: by_weight
    use_preset_vocabulary: true

    import_tables:
      - luna_pinyin
      - luna_pinyin.sogou
    ...

    $ cat double_pinyin.custom.yaml
    patch:
      # 指定词库文件 luna_pinyin.sogou.dict.yaml
      "translator/dictionary": luna_pinyin.extended

最终 `~/Library/Rime` 目录下面的文件：

    $ ll
    total 174416
    drwxr-xr-x  13 mac  staff   416B  3 15 13:52 build/
    -rw-r--r--   1 mac  staff   125B  3 15 13:22 default.custom.yaml
    -rw-r--r--   1 mac  staff   104B  3 15 13:50 double_pinyin.custom.yaml      <-- 导入 sogou + pinyin 扩展码表配置
    -rw-r--r--   1 mac  staff   3.0K  3 15 13:46 double_pinyin.schema.yaml      <-- 自然码双拼输入法配置
    -rw-r--r--   1 mac  staff   3.0K  3 15 11:27 double_pinyin.schema.yaml.ori
    -rw-r--r--   1 mac  staff   209B  3 15 11:26 installation.yaml
    -rw-r--r--   1 mac  staff   589B  3 15 15:43 luna_pinyin.extended.dict.yaml <-- sogou + pinyin 扩展码表
    -rw-r--r--@  1 mac  staff    85M  3 15 11:44 luna_pinyin.sogou.dict.yaml    <-- sogou 码表文件
    drwxr-xr-x  11 mac  staff   352B  3 15 13:52 luna_pinyin.userdb/
    -rw-r--r--   1 mac  staff   1.0K  3 15 12:35 squirrel.custom.yaml
    -rw-r--r--   1 mac  staff   163B  3 15 13:52 user.yaml

然后测试输入 `只缘身在此山中` 测试是否生效。

# reference

Squirrel 内置 **候选框** 样式：<https://gist.github.com/wd/26e0ce3751e2b8da64a3300dc7c0f926>

![img](https://user-images.githubusercontent.com/58177/50718674-0c2b1180-10cd-11e9-85e4-b0c2cb185f21.png)

<https://github.com/rime/home/wiki/CustomizationGuide#一例定製小狼毫配色方案>

![img](http://i.imgur.com/hSty6cB.png)

[我的 Rime 2017-06-17](https://blog.dwx.io/my-rime/)

<https://github.com/15cm/rime-config/blob/master/double_pinyin_flypy.custom.yaml>

[中州韵输入法(rime)导入搜狗词库 2019-09-11](https://www.cnblogs.com/dylanchu/p/11507492.html)


# TODO

[「Rime 增强计划」—— 让小狼毫更好用の BetterRime 增强包です](http://tieba.baidu.com/p/4125987751)

<https://github.com/xiaoTaoist/rime-dict>

[Rime 詞庫](https://github.com/rime-aca/dictionaries)

<br/>

本文标题 | [{{ page.title }}]({{ page.url }})
-------- |:--------
原始链接 | <{{ site.url }}{{ page.url }}>
